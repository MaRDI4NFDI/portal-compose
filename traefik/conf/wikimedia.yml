http:
  routers:
  # work around Let’s Encrypt’s limits (max 50 certs, max 100 domains per cert)
  {{$sites := fromJson
  "{\"wiki\":  {\"grp1\": [\"ab\", \"ady\", \"af\", \"als\", \"alt\", \"am\", \"ami\", \"an\", \"ang\", \"anp\", \"ar\", \"ary\", \"arz\", \"as\", \"ast\", \"av\", \"avk\", \"awa\", \"ay\", \"az\", \"azb\", \"ba\", \"ban\", \"bar\", \"bat-smg\", \"bcl\", \"bdr\", \"be\", \"be-x-old\", \"bew\", \"bg\", \"bh\", \"bjn\", \"blk\", \"bm\", \"bn\", \"bo\", \"bpy\", \"br\", \"bs\", \"btm\", \"bug\", \"bxr\", \"ca\", \"cbk-zam\", \"cdo\", \"ce\", \"ceb\", \"ch\"], \"grp2\": [\"ckb\", \"co\", \"commons\", \"crh\", \"cs\", \"csb\", \"cu\", \"cv\", \"cy\", \"da\", \"dag\", \"de\", \"dga\", \"din\", \"diq\", \"dsb\", \"dtp\", \"dty\", \"dv\", \"dz\", \"el\", \"eml\", \"en\", \"eo\", \"es\", \"et\", \"eu\", \"ext\", \"fa\", \"fat\", \"ff\", \"fi\", \"fiu-vro\", \"fj\", \"fo\", \"fr\", \"frp\", \"frr\", \"fur\", \"fy\", \"ga\", \"gag\", \"gan\", \"gd\", \"gl\", \"glk\", \"gn\", \"gom\", \"gor\", \"got\"], \"grp3\": [\"gpe\", \"gu\", \"gv\", \"ha\", \"hak\", \"haw\", \"he\", \"hi\", \"hif\", \"hr\", \"hsb\", \"ht\", \"hu\", \"hy\", \"hyw\", \"ia\", \"iba\", \"id\", \"ie\", \"ig\", \"ilo\", \"incubator\", \"inh\", \"io\", \"is\", \"it\", \"ja\", \"jam\", \"jbo\", \"jv\", \"ka\", \"kaa\", \"kab\", \"kbd\", \"kcg\", \"kg\", \"kge\", \"ki\", \"kk\", \"kl\", \"km\", \"kn\", \"knc\", \"ko\", \"krc\", \"ks\", \"ksh\", \"ku\", \"kv\", \"kw\"], \"grp4\": [\"ky\", \"la\", \"labs\", \"lad\", \"lb\", \"lbe\", \"lez\", \"lfn\", \"lg\", \"li\", \"lij\", \"lld\", \"lmo\", \"ln\", \"lo\", \"logoc\", \"lrc\", \"lt\", \"ltg\", \"lv\", \"mad\", \"mai\", \"map-bms\", \"mediawiki\", \"meta\", \"mg\", \"mhr\", \"mi\", \"min\", \"mk\", \"ml\", \"mn\", \"mni\", \"mnw\", \"mo\", \"mr\", \"mrj\", \"ms\", \"mt\", \"mwl\", \"my\", \"myv\", \"mzn\", \"nah\", \"nap\", \"nds\", \"nds-nl\", \"ne\", \"new\", \"nia\"], \"grp5\": [\"nl\", \"nn\", \"no\", \"nov\", \"nr\", \"nrm\", \"nso\", \"nv\", \"ny\", \"olo\", \"om\", \"or\", \"os\", \"outreach\", \"pa\", \"pag\", \"pam\", \"pap\", \"pcd\", \"pcm\", \"pdc\", \"pfl\", \"pi\", \"pl\", \"pms\", \"pnb\", \"pnt\", \"ps\", \"pt\", \"pwn\", \"qu\", \"rm\", \"rmy\", \"ro\", \"roa-rup\", \"roa-tara\", \"rsk\", \"ru\", \"rue\", \"rw\", \"sa\", \"sah\", \"sat\", \"sc\", \"scn\", \"sco\", \"sd\", \"se\", \"sh\", \"shi\"], \"grp6\": [\"shn\", \"si\", \"simple\", \"sk\", \"skr\", \"sl\", \"sm\", \"smn\", \"sn\", \"so\", \"sources\", \"species\", \"sq\", \"sr\", \"ss\", \"st\", \"stq\", \"strategy\", \"su\", \"sv\", \"sw\", \"syl\", \"szl\", \"ta\", \"tcy\", \"tdd\", \"te\", \"test\", \"test2\", \"tet\", \"tg\", \"th\", \"tk\", \"tl\", \"tly\", \"tn\", \"tpi\", \"tr\", \"ts\", \"tt\", \"tum\", \"tw\", \"ty\", \"tyv\", \"udm\", \"ug\", \"uk\", \"ur\", \"usability\", \"uz\"], \"grp7\": [\"vec\", \"vep\", \"vi\", \"vls\", \"vo\", \"wa\", \"war\", \"wikidata\", \"wikimania2007\", \"wo\", \"wuu\", \"xal\", \"xh\", \"xmf\", \"yi\", \"yo\", \"za\", \"zea\", \"zgh\", \"zh\", \"zh-classical\", \"zh-min-nan\", \"zh-yue\", \"zu\"]}, \"wikibooks\": { \"grp8\": [\"af\", \"ang\", \"ar\", \"az\", \"ba\", \"be\", \"bg\", \"bn\", \"ca\", \"cs\", \"da\", \"de\", \"el\", \"en\", \"eo\", \"es\", \"et\", \"eu\", \"fa\", \"fi\", \"fr\", \"gl\", \"he\", \"hi\", \"hr\", \"hu\", \"hy\", \"id\", \"is\", \"it\", \"ja\", \"ka\", \"km\", \"ko\", \"ku\", \"la\", \"lt\", \"lv\", \"mk\", \"ml\", \"ms\", \"ne\", \"nl\", \"no\", \"oc\", \"pa\", \"pl\", \"pt\", \"ro\"], \"grp9\": [\"ru\", \"shn\", \"si\", \"simple\", \"sk\", \"sl\", \"sq\", \"sr\", \"sv\", \"ta\", \"te\", \"tg\", \"th\", \"tl\", \"tr\", \"tt\", \"uk\", \"ur\", \"vi\", \"zh\", \"zh-min-nan\"]}, \"wikimedia\": { \"grp10\": [\"ae\", \"az\", \"br\", \"de-labs\", \"en-labs\", \"flaggedrevs-labs\", \"ge\", \"id\", \"liquidthreads-labs\", \"pl\", \"readerfeedback-labs\", \"ru\", \"ua\", \"uk\"]}, \"wikinews\": { \"grp11\": [\"ar\", \"cs\", \"de\", \"el\", \"en\", \"es\", \"fa\", \"fi\", \"fr\", \"he\", \"hu\", \"it\", \"ja\", \"ko\", \"pl\", \"pt\", \"ro\", \"ru\", \"shn\", \"sr\", \"ta\", \"tr\", \"uk\", \"zh\"]}, \"wikiquote\": { \"grp12\": [\"ar\", \"as\", \"az\", \"bg\", \"bjn\", \"br\", \"ca\", \"cy\", \"da\", \"de\", \"el\", \"en\", \"eo\", \"es\", \"fa\", \"fr\", \"gl\", \"gu\", \"he\", \"hi\", \"hu\", \"it\", \"ja\", \"ka\", \"ko\", \"no\", \"pl\", \"pt\", \"ru\", \"simple\", \"sl\", \"sr\", \"su\", \"ta\", \"th\", \"tl\", \"tr\", \"uk\", \"uz\", \"vi\", \"zh\"]}, \"wikisource\": { \"grp13\": [\"ar\", \"as\", \"az\", \"be\", \"bg\", \"bn\", \"br\", \"ca\", \"cs\", \"cy\", \"da\", \"de\", \"el\", \"en\", \"eo\", \"es\", \"et\", \"eu\", \"fa\", \"fi\", \"fr\", \"gl\", \"gu\", \"he\", \"hi\", \"hr\", \"hu\", \"hy\", \"id\", \"it\", \"ja\", \"jv\", \"ka\", \"kn\", \"ko\", \"la\", \"lij\", \"mk\", \"ml\", \"mr\", \"ms\", \"nap\", \"nl\", \"no\", \"pa\", \"pl\", \"pt\", \"ro\", \"ru\"], \"grp14\": [\"sa\", \"sl\", \"sr\", \"su\", \"sv\", \"ta\", \"tcy\", \"te\", \"th\", \"tr\", \"uk\", \"vec\", \"vi\", \"zh\", \"zh-min-nan\"]}, \"wikiversity\": { \"grp15\": [\"ar\", \"beta\", \"cs\", \"de\", \"el\", \"en\", \"es\", \"fr\", \"hi\", \"it\", \"ja\", \"ko\", \"pt\", \"ru\", \"sl\", \"sv\", \"zh\"]}, \"wikivoyage\": { \"grp16\": [\"bn\", \"cs\", \"de\", \"en\", \"eo\", \"es\", \"fa\", \"fr\", \"he\", \"hi\", \"id\", \"it\", \"ja\", \"nl\", \"pt\", \"ru\", \"shn\", \"tr\", \"uk\", \"vi\", \"zh\"]}, \"wiktionary\": { \"grp17\": [\"af\", \"ar\", \"az\", \"bg\", \"bn\", \"br\", \"bs\", \"ca\", \"cs\", \"cy\", \"da\", \"de\", \"el\", \"en\", \"eo\", \"es\", \"et\", \"fa\", \"fi\", \"fr\", \"gd\", \"gl\", \"gom\", \"he\", \"hi\", \"hif\", \"hu\", \"hy\", \"id\", \"ie\", \"is\", \"it\", \"ja\", \"ka\", \"kaa\", \"kk\", \"km\", \"kn\", \"ko\", \"ku\", \"lmo\", \"lt\", \"mg\", \"mk\", \"ml\", \"mn\", \"mnw\", \"mr\", \"ms\"], \"grp18\": [\"nds\", \"nl\", \"no\", \"oc\", \"pl\", \"pt\", \"ro\", \"ru\", \"sd\", \"sg\", \"si\", \"simple\", \"skr\", \"sq\", \"sr\", \"sv\", \"ta\", \"te\", \"th\", \"tl\", \"tr\", \"uk\", \"uz\", \"vec\", \"vi\", \"wa\", \"yue\", \"zh\"]}}"
}}{{range $siteId, $v := $sites}}
  {{- range $groupId, $languages := $v}}
    wiki-wmf-{{$groupId}}:
      rule: {{$first := true}}
      {{- range $lang := $languages}}
        {{- if $first}}
          {{- $first = false}}
        {{- else -}}
          ||
        {{- end -}}
      Host(`{{$lang}}.{{$siteId}}.{{ env "WIKIBASE_HOST" }}`) {{end}}
      service: wikibase-service@docker
      entryPoints:
        - websecure
      tls:
        certResolver: le
      {{end}}{{end}}
